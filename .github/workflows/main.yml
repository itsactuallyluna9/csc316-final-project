name: Build SuperFancyInteropMod

on:
  push:
    branches: main
  pull_request:

jobs:
  build:
    name: Build and create release
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./hk-mods/SuperFancyInteropMod
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Fetch Unity Engine modules
        run: |
          wget https://files.catbox.moe/i4sdl6.zip -O UnityModules.zip
          unzip UnityModules.zip -d References

      - name: Fetch API files
        run: |
          wget https://github.com/hk-modding/api/releases/latest/download/ModdingApiWin.zip -O API.zip
          unzip -o API.zip -d References

      # - name: Fetch a dependency
      #   run: |
      #     wget {dependencyLink} -O {dependencyName}.zip
      #     unzip -o {dependencyName}.zip -d References

      - name: Setup DotNet
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: 9.0.305

      - name: Build project
        run: dotnet build --configuration Release

      - name: Get SHA256 of zipped mod
        id: get_hash
        run: echo "::set-output name=hash::$(sha256sum Output/SuperFancyInteropMod.zip | cut -d ' ' -f 1)"

      - name: Get Assembly version
        id: get_version
        run: echo "::set-output name=version::$(cat < Version.txt)"

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: SuperFancyInteropMod-${{ steps.get_version.outputs.version }}
          path: hk-mods/SuperFancyInteropMod/Output/SuperFancyInteropMod.zip

      # - name: Create release
      #   id: create_release
      #   uses: actions/create-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     tag_name: ${{ steps.get_version.outputs.version }}
      #     release_name: Release v${{ steps.get_version.outputs.version }}
      #     body: "SHA256: ${{ steps.get_hash.outputs.hash }}"
      #     draft: false
      #     prerelease: false

      # - name: Upload release asset
      #   uses: actions/upload-release-asset@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     upload_url: ${{ steps.create_release.outputs.upload_url }}
      #     asset_path: Output/HKMod.zip
      #     asset_name: HKMod.zip
      #     asset_content_type: application/zip
